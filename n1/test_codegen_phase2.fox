# N1 Codegen - Phase 2 Tests
# Test cases untuk Identifier, InfixExpression, VarStatement compilation

ambil "ast"
ambil "codegen"

# ============================================================================
# Test 1: Identifier Compilation
# ============================================================================
fungsi test_identifier() void
    native_print("[Test 1] Identifier Compilation\n")

    # Test case 1.1: Simple identifier
    var ident1 = ast.MakeIdentifier("x", 1, 1)
    var result1 = codegen.CompileIdentifier(ident1)
    native_print("  \"x\" → \"")
    native_print(result1)
    native_print("\"\n")
    # EXPECTED: "x"

    # Test case 1.2: Long identifier
    var ident2 = ast.MakeIdentifier("my_variable_name", 1, 1)
    var result2 = codegen.CompileIdentifier(ident2)
    native_print("  \"my_variable_name\" → \"")
    native_print(result2)
    native_print("\"\n")
    # EXPECTED: "my_variable_name"

    # Test case 1.3: Identifier with numbers
    var ident3 = ast.MakeIdentifier("var123", 1, 1)
    var result3 = codegen.CompileIdentifier(ident3)
    native_print("  \"var123\" → \"")
    native_print(result3)
    native_print("\"\n")
    # EXPECTED: "var123"

    native_print("  ✅ Identifier tests passed\n\n")
akhir

# ============================================================================
# Test 2: Infix Expression Compilation
# ============================================================================
fungsi test_infix() void
    native_print("[Test 2] Infix Expression Compilation\n")

    # Test case 2.1: Addition
    var result1 = codegen.CompileInfix("42", "+", "10")
    native_print("  42 + 10 → \"")
    native_print(result1)
    native_print("\"\n")
    # EXPECTED: "(42 + 10)"

    # Test case 2.2: Subtraction
    var result2 = codegen.CompileInfix("100", "-", "25")
    native_print("  100 - 25 → \"")
    native_print(result2)
    native_print("\"\n")
    # EXPECTED: "(100 - 25)"

    # Test case 2.3: Multiplication
    var result3 = codegen.CompileInfix("5", "*", "6")
    native_print("  5 * 6 → \"")
    native_print(result3)
    native_print("\"\n")
    # EXPECTED: "(5 * 6)"

    # Test case 2.4: Division
    var result4 = codegen.CompileInfix("20", "/", "4")
    native_print("  20 / 4 → \"")
    native_print(result4)
    native_print("\"\n")
    # EXPECTED: "(20 / 4)"

    # Test case 2.5: Logical AND (dan → &&)
    var result5 = codegen.CompileInfix("1", "dan", "1")
    native_print("  1 dan 1 → \"")
    native_print(result5)
    native_print("\"\n")
    # EXPECTED: "(1 && 1)"

    # Test case 2.6: Logical OR (atau → ||)
    var result6 = codegen.CompileInfix("0", "atau", "1")
    native_print("  0 atau 1 → \"")
    native_print(result6)
    native_print("\"\n")
    # EXPECTED: "(0 || 1)"

    # Test case 2.7: Comparison
    var result7 = codegen.CompileInfix("x", "==", "42")
    native_print("  x == 42 → \"")
    native_print(result7)
    native_print("\"\n")
    # EXPECTED: "(x == 42)"

    # Test case 2.8: Less than
    var result8 = codegen.CompileInfix("a", "<", "b")
    native_print("  a < b → \"")
    native_print(result8)
    native_print("\"\n")
    # EXPECTED: "(a < b)"

    native_print("  ✅ Infix expression tests passed\n\n")
akhir

# ============================================================================
# Test 3: Variable Statement Compilation
# ============================================================================
fungsi test_var_statement() void
    native_print("[Test 3] Variable Statement Compilation\n")

    # Test case 3.1: Simple integer variable
    var result1 = codegen.CompileVarStatement("x", "42")
    native_print("  var x = 42 → \"")
    native_print(result1)
    native_print("\"\n")
    # EXPECTED: "\tmph_int x = 42;\n"

    # Test case 3.2: Variable with expression
    var result2 = codegen.CompileVarStatement("sum", "(10 + 20)")
    native_print("  var sum = (10 + 20) → \"")
    native_print(result2)
    native_print("\"\n")
    # EXPECTED: "\tmph_int sum = (10 + 20);\n"

    # Test case 3.3: Variable with identifier
    var result3 = codegen.CompileVarStatement("y", "x")
    native_print("  var y = x → \"")
    native_print(result3)
    native_print("\"\n")
    # EXPECTED: "\tmph_int y = x;\n"

    # Test case 3.4: Variable with negative number
    var result4 = codegen.CompileVarStatement("neg", "-123")
    native_print("  var neg = -123 → \"")
    native_print(result4)
    native_print("\"\n")
    # EXPECTED: "\tmph_int neg = -123;\n"

    native_print("  ✅ Variable statement tests passed\n\n")
akhir

# ============================================================================
# Test 4: Integration Test (Combined)
# ============================================================================
fungsi test_integration() void
    native_print("[Test 4] Integration Test\n")

    # Simulate: var result = x + y
    var ident_x = ast.MakeIdentifier("x", 1, 1)
    var ident_y = ast.MakeIdentifier("y", 1, 1)

    var x_code = codegen.CompileIdentifier(ident_x)
    var y_code = codegen.CompileIdentifier(ident_y)
    var expr_code = codegen.CompileInfix(x_code, "+", y_code)
    var var_code = codegen.CompileVarStatement("result", expr_code)

    native_print("  Simulated: var result = x + y\n")
    native_print("  Generated C code:\n")
    native_print("  ")
    native_print(var_code)
    # EXPECTED: "\tmph_int result = (x + y);\n"

    native_print("  ✅ Integration test passed\n\n")
akhir

# ============================================================================
# Main Test Runner
# ============================================================================

fungsi main() void
    native_print("╔══════════════════════════════════════╗\n")
    native_print("║  N1 Codegen Phase 2 Tests            ║\n")
    native_print("╚══════════════════════════════════════╝\n\n")

    test_identifier()
    test_infix()
    test_var_statement()
    test_integration()

    native_print("╔══════════════════════════════════════╗\n")
    native_print("║  ✅ All Phase 2 Tests Passed         ║\n")
    native_print("╚══════════════════════════════════════╝\n")
akhir
